<!DOCTYPE html> 
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <title>forna</title>

  <!-- CSS -->
  <!-- Bootstrap: http://getbootstrap.com/ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- custom CSS -->
  <link href='css/force.css' rel='stylesheet' type='text/css' />
  <link href='css/interface.css' rel='stylesheet' type='text/css' />

  <!-- Java Script -->
  <!-- Get jQuery -- use local if unavailable -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">/* <![CDATA[ */
    !window.jQuery && document.write('<script type="text/javascript" src="js/jquery.js"><\/script>')
  /* ]]> */</script>
  <!-- Knockout: http://knockoutjs.com/downloads/index.html -->
  <script type="text/javascript" src="js/knockout-3.1.0.js"></script>
  <!-- Bootstrap Javascript Plugins: http://getbootstrap.com/ -->
  <script type='text/javascript' src="js/bootstrap.min.js"></script>
  <!-- D3 -->
  <script src="js/d3.js"></script>
</head>
<body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">forna</a>
      </div>
    </div>
  </nav>
    <div class="container" role="main" id="main" style="padding: 20px;">
      <form role="form">
        <div class="form-group">
          <label for="Input">Sequence and Structure</label>
          <textarea type="email" class="form-control" id="Input" placeholder="" data-bind="value: input" rows="2"></textarea>
        </div>
        <button data-bind="click: submit" type="submit" class="btn btn-default">Submit</button>
    <button class="btn btn-default" id="save_as_svg" value="" type='button'>
                    Save as SVG</button>
      </form>
      
      <div class="gallery" id='chart'> </div>
      <hline>
  </div>
  
  
        <script type="text/javascript">
$(document).ready(function() {
        $("#save_as_svg").click(function() { 
                console.log("hello"); 
                var svg = document.getElementById('plotting-area');

                //get svg source.
                var serializer = new XMLSerializer();
                var source = serializer.serializeToString(svg);

                //add name spaces.
                if(!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){
                    source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
                    }
                    if(!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)){
                        source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
                        }

                        //add xml declaration
                        source = '<?xml version="1.0" standalone="no"?>\r\n' + source;

                        //convert svg source to URI data scheme.
                        var url = "data:image/svg+xml;charset=utf-8,"+encodeURIComponent(source);

                        //set url value to a element's href attribute.
                        location.href = url;
                });
        });
        </script>
  
  <script type="text/javascript">
    
    serverURL = "";
    
    // custom ajax call
    ajax = function(uri, method, data) {
      var request = {
        url: uri,
        type: method,
        contentType: "application/json",
        accepts: "application/json",
        cache: false,
        dataType: 'json',
        data: data,
        error: function(jqXHR) {
            console.log("ajax error " + jqXHR.status);
        }
      };
      return $.ajax(request);
    }
    
    // Knockout view model for RNA
    function RNAViewModel() {
      var self = this;
      
      self.input = ko.observable('');
      self.ss = ko.computed(function() {
        return this.input().split("\n");
      }, this);
      
      self.submit = function() {
        ajax(serverURL + '/struct_graph', 'POST', JSON.stringify( {seq: self.ss()[0], struct: self.ss()[1]} )).success( function(data) {
          draw(data);
        });
      }
    }
    
    // bind the model to the ui
    ko.applyBindings(new RNAViewModel());
    
  </script>
  <script type="text/javascript" src="js/force.js"></script>
</body>
</html>
