<!DOCTYPE html> 
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  
  <title>forna</title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="RNA Secondary Structure Visualization Using a Force Directed Graph Layout">
  <meta name="keywords" content="RNA, secundary structure, visualization, force directed graph, plot, svg">
  <meta name="author" content="Stefan Hammer">
  <meta name="author" content="Peter Kerpedjiev">

  <!-- CSS -->
  <!-- Bootstrap: http://getbootstrap.com/ -->
  <link rel='stylesheet' type='text/css' href="css/bootstrap.min.css">
  <link rel='stylesheet' type='text/css' href="css/bootstrap.css">
  <!-- custom CSS -->
  <link rel='stylesheet' type='text/css' href='css/force.css' />
  <link rel='stylesheet' type='text/css' href='css/interface.css' />

  <!-- Java Script -->
  <!-- Get jQuery use local if unavailable -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">/* <![CDATA[ */
    !window.jQuery && document.write('<script type="text/javascript" src="js/jquery.js"><\/script>')
  /* ]]> */</script>
  <!-- Knockout: http://knockoutjs.com/downloads/index.html -->
  <script type="text/javascript" src="js/knockout-3.1.0.js"></script>
  <!-- Bootstrap Javascript Plugins: http://getbootstrap.com/ -->
  <script type='text/javascript' src="js/bootstrap.min.js"></script>
  <!-- D3 -->
  <script src="js/d3.js"></script>
  <!-- File Saver https://github.com/eligrey/FileSaver.js -->
  <script type='text/javascript' src="js/FileSaver.min.js"></script>
  <!-- saveSvgAsPng.js -->
  <script type='text/javascript' src="js/saveSvgAsPng.js"></script>
</head>
<body>
  <!-- 'Add new molecule' modal -->
  <div class="modal fade" id="add" > <!-- data-bind="showModal: loaded"-->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">Add RNA Molecule</h4>
        </div>
        <div class="modal-body">
          <form role="form">
            <div class="form-group">
              <label for="Input">Sequence and Structure</label>
              <textarea type="text" class="form-control" id="Input" placeholder="" rows="2" data-bind="value: input" autofocus required></textarea>
            </div>
            <div class="alert alert-danger" role="alert" data-bind="visible: inputError().length > 0, html: inputError" id="inputError"> </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" id="Submit" data-bind="click: submit" class="btn btn-primary" data-loading-text="Loading...">Submit</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  
  <!-- 'Add PDB molecule' modal -->
  <div class="modal fade" id="addPDB" > <!-- data-bind="showModal: loaded"-->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">Add PDB File</h4>
        </div>
        <div class="modal-body">
          <form role="form">
            <div class="form-group">
              <label for="Input">File Input</label>
              <input type="file" id="inputPDBFile" data-bind="event: { change: function() { uploadPDB($element.files[0]) }}" }>
               <p class="help-block">Please select a PDB file to extract the secondary structure from.</p>
            </div>
            <div class="alert alert-danger" role="alert" data-bind="visible: inputError().length > 0, html: inputError" id="inputError"> </div>
          </form>
          <!-- <progress></progress> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" id="PDBSubmit" data-bind="click: submit" class="btn btn-primary" data-loading-text="Loading...">Submit</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <!-- 'Custom Colors' modal -->
  <div class="modal fade" id="addColors" > <!-- data-bind="showModal: loaded"-->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">Edit Color Scheme</h4>
        </div>
        <div class="modal-body">
          <form role="form">
            <div class="form-group">
              <label for="Input">Color Specifications:</label>
              <textarea type="text" class="form-control" id="ColorInput" placeholder="" rows="2" data-bind="value: input" autofocus required></textarea>
            </div>
            <div class="alert alert-danger" role="alert" data-bind="visible: inputError().length > 0, html: inputError" id="inputError"> </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" id="ColorSubmit" data-bind="click: colorSubmit" class="btn btn-primary" data-loading-text="Loading...">Submit</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal custom colors -->

  <!-- 'About' modal -->
  <div class="modal fade" id="about">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">About forna</h4>
        </div>
        <div class="modal-body">
          <h3 id="rna-secondary-structure-visualization-using-a-force-directed-graph-layout">RNA Secondary Structure Visualization Using a Force Directed Graph Layout</h3>
          <h4 id="overview">Overview</h4>
          <p>The <code>forna</code> package provides a web interface for displaying RNA secondary
          structures using the <a href="https://github.com/mbostock/d3/wiki/Force-Layout">force-directed graph
          layout</a> provided by the
          <a href="http://d3js.org/">d3.js visualization library</a>. </p>
          <p>The front end makes use of <a href="getbootstrap.com">Bootstrap</a> and
          <a href="http://knockoutjs.com/">Knockout.js</a> for the user interfact while the back end
          uses <a href="http://flask.pocoo.org/">Flask</a> to serve the static files and provide a
          REST API. The RNA structure manipulation and graph construction is created
          using the python <a href="http://www.tbi.univie.ac.at/~pkerp/forgi/">forgi</a> RNA
          structure manipulation library and the provided <code>forna.py</code> script. We heavily
          depend on the python bindings of the <a href="http://www.tbi.univie.ac.at/RNA/">ViennaRNA</a> package.</p>
          <h4 id="usage">Usage</h4>
          <p>Click on <code>Add Molecule</code> to draw a new secondary structure. The input should
          contain a sequence and a secondary structure in dot-bracket notation:</p>
          <pre><code>GCUUCAUAUAAUCCUAAUGAUAUGGUUUGGGAGUUUCUACCAAGAGCCUUAAACUCUUGAUUAUGAAGUG<br>((((((((((..((((((.........))))))......).((((((.......))))))..)))))))))</code></pre>
          <p>You can also use the <strong>FASTA</strong> format to add multiple molecule at once. If you do
          not enter a structure, it will calculate the MFE structure at 37Â°C for you.</p>
          <p><strong>Zooming</strong> can be accomplished using the mouse wheel.
          Dragging the canvas leads to <strong>panning</strong>.</p>
          <h5 id="colors">Colors</h5>
          <h6 id="position">Position</h6>
          <p>Color the nucleotides according to their position in the molecule. Lower numbered
          nucleotides are closer to the 5' end and are colored green. Nucleotides in the middle
          are colored yellow whereas nucleotides near the 3' end are colored red.</p>
          <h6 id="structure">Structure</h6>
          <p>Color the nucleotides according to the type of structure that they are in:</p>
          <p><strong><font color='lightgreen'>Green</font></strong>: Stems (canonical helices) <br>
          <strong><font color='#ff9896'>Red</font></strong>: Multiloops (junctions)<br>
          <strong><font color='#dbdb8d'>Yellow</font></strong>: Interior Loops<br>
          <strong><font color='lightblue'>Blue</font></strong>: Hairpin loops<br>
          <strong><font color='lightsalmon'>Orange</font></strong>: 5' unpaired region<br>
          <strong><font color='cyan'>Cyan</font></strong>: 3' unpaired region</p>
          <h6 id="sequence">Sequence</h6>
          <p>Color according to the nucleotide types: </p>
          <p><strong><font color='#dbdb8d'>Yellow</font></strong>: Adenine <br>
          <strong><font color="#98df8a">Green</font></strong>: Cytosine <br>
          <strong><font color='#ff9896'>Blue</font></strong>: Uridine <br>
          <strong><font color='#aec7e8'>Red</font></strong>: Guanine</p>
          <h6 id="custom">Custom</h6>
          <p> Create a custom coloring scheme. The colors for each nucleotide or sets of nucleotide are specified in the 
          text box that appears when the tab is clicked. The format is simple. The first column should always be 'color',
          since other types of coloring (i.e. highlighting) will be implemented in the future. The second column will
          contain the name of the molecule (indicated by the '>' line in the 'Add Molecule' input area). The third 
          column will contain a list of nucleotides. This can be individual nucleotides or ranges. Multiple nucleotides
          or ranges can be separated by commas (i.e. '7,14-16' indicates nucleotides 7,14,15 and 16). The final line
          contains the color (i.e. 'red', or '0xFF0000'). If a single number between 0 and 1 is specified in the final
          column, it will be used to select a shade between white and steel blue. This is useful for showing values
          associated with various nucleotides (i.e. conservation, reactivities, etc...).</p>
          <h4 id="runing-locally">Runing Locally</h4>
          <p>The server can be run locally on your machine. It depends on the <a href="http://www.tbi.univie.ac.at/~pkerp/forgi/">forgi</a> library and needs the <a href="http://www.tbi.univie.ac.at/RNA/">ViennaRNA</a> package installed with python bindings enabled.
          To run it use the following command:</p>
          <pre><code class="lang-shell">python forna_server.py -s -d</code></pre>
          <p>Documentation about the available options is provided using the <code>-h</code> option.</p>
          <h4 id="contact">Contact</h4>
          <p>Questions and/or comments can be sent to <a href="mailto:forna@tbi.univie.ac.at">forna@tbi.univie.ac.at</a></p>
          <h4 id="acknowledgement">Acknowledgement</h4>
          <p>This project is, among others, supported by the European Commission under the Environment Theme of the 7th Framework Program for Research and Technological Development (Grant agreement no: 323987).</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  
  <!-- Main content starts here! -->
  <div class="container" role="main" id="main">

    <div class="row">
      <div class="col-md-4 col-xs-12">
          <div class="btn-group">
              <button class="btn btn-primary" data-bind="click: showAdd">Add Molecule</button>
              <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                  <span class="caret"></span>
                  <span class="sr-only">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu" role="menu">
                  <li><a data-bind="click: showAdd" >Add Sequence and Secondary Structure</a></li>
                  <li><a data-bind="click: showAddPDB">Add PDB File</a></li>
              </ul>
          </div>
        <button class="btn btn-default" data-bind="click: clearGraph">Clear Graph</button>
      </div>
      <div class="col-md-5 col-md-offset-3 col-xs-12">
        <form role="form">
          <div class="form-group pull-right">
            <div class="btn-group" id="Colors" data-toggle="tooltip" data-placement="left" title="Choose the color scheme" data-delay="800">
              <label class="btn btn-default" data-bind="css: { active: colors() == 'positions' }"><input type="radio" name="colors" data-bind="checked: colors, checkedValue: 'positions'">Positions</label>
              <label class="btn btn-default" data-bind="css: { active: colors() == 'structure' }"><input type="radio" name="colors" data-bind="checked: colors, checkedValue: 'structure'">Structure</label>
              <label class="btn btn-default" data-bind="css: { active: colors() == 'sequence' }"><input type="radio" name="colors" data-bind="checked: colors, checkedValue: 'sequence'">Sequence</label>
              <label class="btn btn-default" data-bind="css: { active: colors() == 'custom' }"><input type="radio" name="colors" data-bind="checked: colors, checkedValue: 'custom', checkedVaue: 'custom'">Custom</label>
              <label class="btn btn-default" data-bind="css: { active: colors() == 'custom' }"><input type="radio" name="colors" data-bind="checked: colors, checkedValue: 'custom', click: showCustomColors"><span class="caret"></span></label>
            </div>
            <div class="btn-group" id="About">
              <button data-bind="click: showAbout" class="btn btn-default"><span class="glyphicon glyphicon-question-sign"></span></button>
            
            </div>
          </div>
        </form>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-12 col-xs-12">
        <!-- the graph goes here -->
        <div class="gallery" id='chart'> </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-4 col-md-offset-8 col-xs-12">
        <form role="form">
          <div class="form-group pull-right">
              <div class="btn-group dropup">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="tria">Save As
                      <span class="caret"></span>
                      <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <ul class="dropdown-menu" role="menu">
                      <!-- Dropdown menu links -->
                      <li role="presentation"><a role="menuitem" data-bind="click: saveSVG" download="rna.svg" data-toggle="tooltip" data-placement="left" title="Save as SVG file" data-delay="800">SVG</a></li>
                      <li role="presentation"><a role="menuitem" data-bind="click: savePNG" download="rna.png" data-toggle="tooltip" data-placement="left" title="Save as PNG file" data-delay="800">PNG</a></li>
                  </ul>
              </div>

        </form>
      </div>
    </div>
    
    <!-- foce field javascript -->
    <script type="text/javascript" src="js/force.js"></script>
    <!-- interface javascript -->
    <script type="text/javascript" src="js/interface.js"></script>
  </div>
  <canvas width="960" height="500" style="display:none"></canvas>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
           })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55640065-1', 'auto');
      ga('send', 'pageview');
  </script>
</body>
</html>
